machine:
  java:
    version: oraclejdk8
  services:
    - docker
dependencies:
  pre:
    commands:
      - APPLICATION_PROPERTIES=$HOME"/java-facebook-chatbot/src/main/resources/application.properties"
      - export APPLICATION_PROPERTIES
      - sed -i 's/^validation.token=.*/validation.token=$SAMPLE_TOKEN/g' $APPLICATION_PROPERTIES
      - sed -i 's/^app.secret=.*/app.secret=$SAMPLE_TOKEN/g' $APPLICATION_PROPERTIES
      - sed -i 's/^page.access.token=.*/age.access.token=$SAMPLE_TOKEN/g' $APPLICATION_PROPERTIES
      - cat $APPLICATION_PROPERTIES
  override:
    - mvn dependency:go-offline
test:
  override:
    - mvn integration-test
deployment:
  dev:
    branch: master
    commands: 
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker build -t hieupham/java-fb-chat .
    - docker push hieupham/java-fb-chat
